//- -*- tab-width: 2 -*-
extends includes/layout

block vars
  - var ngAppDef = 'RunAdmin'

append scripts
  script.
    var competitionId = "#{id}"
  script(src = '/components/angular-bootstrap-datetimepicker/src/js/datetimepicker.js')
  script(src = '/components/angular-bootstrap-datetimepicker/src/js/datetimepicker.templates.js')
  script(src='/javascripts/line_run_admin.js')

append css
  link(rel='stylesheet' href='/components/angular-bootstrap-datetimepicker/src/css/datetimepicker.css')

  style(type='text/css').
    .uib-time input {
      padding-left: 0;
      padding-right: 0;
      width: 2.5em;
      margin-right: 0;
    }

    .uib-timepicker .btn {
      padding-left: 6px;
      padding-right: 6px;
    }

block location
  a.breadcrumb-item(href='/home') Home
  a.breadcrumb-item(href='/admin') Admin
  a.breadcrumb-item(ng-href='/admin/{{competitionId}}') {{competition.name}}
  span.breadcrumb-item.active Line runs

block content
  .row
    .col-md-1
    .col-md-10
      h1 {{competition.name}} - {{"admin.lineRun.title" | translate}}
      table(class="custom")
        thead
          tr
            th {{"common.round" | translate}}
            th {{"common.team" | translate}}
            th {{"common.map" | translate}}
            th {{"common.field" | translate}}
            th {{"common.starttime" | translate}}
            th {{"common.operation" | translate}}
        tbody
          tr
            td
              select(ng-model='run.round' ng-options='round as round.name for round in rounds')
            td
              select(ng-model='run.team' ng-options='team as team.name for team in teams')
            td
              select(ng-model='run.map' ng-options='map as map.name for map in maps')
            td
              select(ng-model='run.field' ng-options='field as field.name for field in fields')
            td
              p.input-group
                span.input-group-btn
                  button.btn.btn-info(type="button" ng-click="openStartDate()")
                    i.fa.fa-calendar(aria-hidden='true')
                input.form-control(type="text" uib-datepicker-popup ng-model="startDate" ng-change="updateStartTime()" is-open="startDatePopup.opened" datepicker-options="startDateOptions" close-text="Close")
              div(uib-timepicker ng-model="startTime" ng-change="updateStartTime()" hour-step="1" minute-step="5" show-meridian="false" show-spinners='true' style="border-bottom:0px;border-left:0px;")
            td
              button(ng-click='addRun()') {{"admin.lineRun.add" | translate}}
      a(ng-href='/admin/{{competitionId}}/line/runs/bulk') {{"admin.lineRun.bulk" | translate}}

      div
          button(ng-click="selectAll()" class='btn btn-primary' style="margin: 5px 5px 5px 5px;") {{"admin.lineRun.selectAll" | translate}}
          button(ng-click="removeSelectedRun()" class='btn btn-danger' style="margin: 5px 5px 5px 5px;") {{"admin.lineRun.delS" | translate}}
          button(ng-click="go('/admin/'+ competitionId +'/line/runs/monitor')" class='btn btn-success' style="margin: 5px 5px 5px 5px; text-align:right;") {{"admin.lineRun.monitor" | translate}}
      center
        .loader
          img(src="/images/loader2.gif")
          p Now Loading...
      table(class="custom")
        thead
          tr
            th
            th {{"common.starttime" | translate}}
            th {{"common.round" | translate}}
            th {{"common.team" | translate}}
            th {{"common.field" | translate}}
            th {{"common.score" | translate}}
            th {{"common.time" | translate}}
            th {{"admin.lineRun.status" | translate}}
            th {{"common.comment" | translate}}
            th
            th
            th
            //th
            th {{"common.operation" | translate}}
        tbody
          tr(ng-repeat='run in runs | orderBy:"[startTime,round.name,field.name,team.name]"' runs-read-finished='')
            td
                input(type='checkbox' ng-model='run.checked' style="display:initial;")
            td(ng-bind='run.startTime | date:"dd EEE HH:mm"' ng-style="{'background-color':run.status==5?'#bdafdb':''}" )
            td(ng-bind='run.round.name' ng-style="{'background-color':run.status==5?'#bdafdb':''}" )
            td(ng-bind='run.team.name' ng-style="{'background-color':run.status==5?'#bdafdb':''}")
            td(ng-bind='run.field.name' ng-style="{'background-color':run.status==5?'#bdafdb':''}")
            td(ng-bind='run.score' ng-style="{'background-color':run.status==5?'#bdafdb':''}")
            td(ng-bind="run.time.minutes*60*1000+run.time.seconds*1000 | date:'mm:ss'" ng-style="{'background-color':run.status==5?'#bdafdb':''}")
            td(ng-style="{'background-color':run.status==4?'#ffadad':''}")
              span(ng-if="run.status==0") {{"admin.lineRun.st0" | translate}}
              span(ng-if="run.status==1") {{"admin.lineRun.st1" | translate}}
              span(ng-if="run.status==2") {{"admin.lineRun.st2" | translate}}
              span(ng-if="run.status==3") {{"admin.lineRun.st3" | translate}}
              span(ng-if="run.status==4") {{"admin.lineRun.st4" | translate}}
              span(ng-if="run.status==5") {{"admin.lineRun.st5" | translate}}
            td(ng-style="{'background-color':run.status==5?'#bdafdb':''}")
              button(uib-popover="{{run.comment}}" popover-trigger="'outsideClick'"  type="button" class="btn btn-default" ng-disabled="run.comment==''") {{"common.comment" | translate}}
            td(ng-style="{'background-color':run.status==5?'#bdafdb':''}")
              button(ng-click="go('/line/view/' + run._id)" class='btn btn-info') {{"common.view" | translate}}
            td(ng-style="{'background-color':run.status==5?'#bdafdb':''}")
              button(ng-click="go_sign(run._id)" class='btn btn-warning') {{"common.sign" | translate}}
            td(ng-style="{'background-color':run.status==5?'#bdafdb':''}")
              button(ng-click="go_judge(run._id)" class='btn btn-danger') {{"common.judge" | translate}}
            //td(ng-style="{'background-color':run.status==5?'#bdafdb':''}")
              button(ng-click="go_approval(run._id)" class='btn btn-secondary') Approval
            td(ng-style="{'background-color':run.status==5?'#bdafdb':''}")
              a(href="" ng-click='removeRun(run._id)') {{"common.delete" | translate}}
